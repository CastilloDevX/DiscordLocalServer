# üí¨ Chat Concurrente en Java - Sistema Cliente-Servidor

## üìã Descripci√≥n del Proyecto

Sistema de chat en tiempo real desarrollado en Java que permite la comunicaci√≥n simult√°nea entre m√∫ltiples usuarios mediante conexiones TCP/IP. El proyecto implementa una arquitectura cliente-servidor utilizando sockets y programaci√≥n concurrente con hilos para manejar m√∫ltiples conexiones simult√°neas.

---

## üéØ Requisitos Implementados (10 puntos)

### ‚úÖ 1. M√©todo `start-connection` (2.5 puntos)

**Descripci√≥n:** Establece la conexi√≥n del cliente con el servidor mediante direcci√≥n IP y puerto especificados.

**Ubicaci√≥n:** Clase `Client.java` - M√©todo `startConnection(String host, int port)`

**Implementaci√≥n:**
```java
public void startConnection(String host, int port) throws IOException {
    socket = new Socket(host, port);
    in  = new DataInputStream(socket.getInputStream());
    out = new DataOutputStream(socket.getOutputStream());
    System.out.println("Conectado al servidor " + host + ":" + port);
}
```

**Uso desde terminal:**

**Opci√≥n 1 - Conexi√≥n local (localhost:8080):**
```bash
java Client
```

**Opci√≥n 2 - Con nombre de usuario predefinido:**
```bash
java Client MiNombre
```

**Opci√≥n 3 - Especificar IP y Puerto personalizados:**
```bash
java Client NombreUsuario 192.168.1.100 8080
```

**Par√°metros:**
- `host`: Direcci√≥n IP del servidor (ej: `192.168.1.100`, `localhost`)
- `port`: Puerto de escucha del servidor (por defecto: `8080`)

**Funcionamiento:**
1. Crea un socket TCP hacia la direcci√≥n IP y puerto especificados
2. Inicializa los streams de entrada (`DataInputStream`) y salida (`DataOutputStream`)
3. Confirma la conexi√≥n exitosa al usuario
4. Permite el intercambio bidireccional de datos con el servidor

---

### ‚úÖ 2. M√©todo `change-userName`

**Descripci√≥n:** Permite a un usuario cambiar su nombre de usuario durante la sesi√≥n activa del chat.

**Ubicaci√≥n:** Clase `Server.java` - M√©todo `changeUserName(String oldName, String newName, ClientHandler handler)`

**Implementaci√≥n:**
```java
static synchronized boolean changeUserName(String oldName, String newName, ClientHandler handler) {
    if (newName == null || newName.isBlank() || clients.containsKey(newName)) 
        return false;
    clients.remove(oldName);
    clients.put(newName, handler);
    return true;
}
```

**Comando para el cliente:**
```
/rename NUEVO_NOMBRE
```

**Ejemplos de uso:**
```
/rename JuanPerez
/rename Admin_01
/rename Usuario123
```

**Funcionamiento:**
1. El cliente env√≠a el comando `/rename` seguido del nuevo nombre
2. El servidor valida que el nuevo nombre no est√© vac√≠o ni en uso
3. Actualiza el nombre en el mapa de clientes (`ConcurrentHashMap`)
4. Notifica al usuario del cambio exitoso
5. Env√≠a un mensaje global informando el cambio a todos los participantes
6. Registra la acci√≥n en el log del servidor con timestamp

**Validaciones:**
- ‚ùå Nombre vac√≠o o con solo espacios
- ‚ùå Nombre ya en uso por otro usuario
- ‚úÖ Nombre √∫nico y v√°lido

---

### ‚úÖ 3. M√©todo `send-msg` (Mensaje Privado)

**Descripci√≥n:** Env√≠a mensajes privados a un usuario espec√≠fico del chat sin que otros usuarios puedan verlo.

**Ubicaci√≥n:** Clase `Server.java` - M√©todo `sendPrivateMessage(String fromUser, String toUser, String message)`

**Implementaci√≥n:**
```java
static boolean sendPrivateMessage(String fromUser, String toUser, String message) {
    ClientHandler target = clients.get(toUser);
    if (target == null) return false;
    target.send("[Private][" + fromUser + "]: " + message);
    return true;
}
```

**Comando para el cliente:**
```
/msg USUARIO MENSAJE
```

**Ejemplos de uso:**
```
/msg Maria Hola, ¬øc√≥mo est√°s?
/msg Admin Necesito ayuda con el proyecto
/msg Pedro ¬øViste el partido de ayer?
```

**Funcionamiento:**
1. El cliente escribe `/msg` seguido del nombre del destinatario y el mensaje
2. El servidor busca al usuario destinatario en el mapa de clientes
3. Si existe, env√≠a el mensaje exclusivamente a ese usuario
4. El mensaje se marca como `[Private]` para identificarlo
5. Si el usuario no existe, notifica al remitente del error
6. El mensaje se registra en el log del servidor

**Formato del mensaje recibido:**
```
[Private][Juan]: Hola, ¬øc√≥mo est√°s?
```

**Validaciones:**
- ‚ùå Usuario destinatario no encontrado ‚Üí Error
- ‚ùå Mensaje vac√≠o ‚Üí No se env√≠a
- ‚úÖ Usuario existe y mensaje v√°lido ‚Üí Se env√≠a

---

### ‚úÖ 4. M√©todo `global-msg` (Mensaje Global)

**Descripci√≥n:** Env√≠a mensajes visibles para todos los usuarios conectados al chat.

**Ubicaci√≥n:** Clase `Server.java` - M√©todo `sendGlobalMessage(String fromUser, String message)`

**Implementaci√≥n:**
```java
static void sendGlobalMessage(String fromUser, String message) {
    String payload = (fromUser == null)
            ? "[Server]: " + message
            : "[" + fromUser + "]: " + message;

    for (ClientHandler ch : clients.values()) {
        ch.send(payload);
    }
}
```

**Comandos para el cliente:**

**Opci√≥n 1 - Comando expl√≠cito:**
```
/all MENSAJE
```

**Opci√≥n 2 - Mensaje directo (comportamiento por defecto):**
```
MENSAJE
```

**Ejemplos de uso:**
```
/all Hola a todos
Hola a todos
¬øAlguien sabe programar en Java?
/all ¬øQu√© opinan del nuevo proyecto?
```

**Funcionamiento:**
1. El cliente escribe un mensaje (con o sin `/all`)
2. El servidor identifica que es un mensaje global
3. Itera sobre todos los clientes conectados en el `ConcurrentHashMap`
4. Env√≠a el mensaje a cada cliente activo
5. El mensaje se muestra con el formato `[Usuario]: mensaje`
6. Se registra en el log del servidor con timestamp

**Formato del mensaje recibido:**
```
[Juan]: Hola a todos
[Server]: Servidor en mantenimiento en 5 minutos
```

**Caracter√≠sticas especiales:**
- Los mensajes del servidor se identifican con `[Server]:`
- Los mensajes de usuarios se identifican con `[NombreUsuario]:`
- Todos los usuarios conectados reciben el mensaje simult√°neamente
- Thread-safe mediante `ConcurrentHashMap`

---

## ‚≠ê FUNCIONALIDAD EXTRA: Comando `/kick` (Punto Extra)

### üö´ Eliminaci√≥n Administrativa de Usuarios

**Descripci√≥n:** Permite al administrador del servidor eliminar usuarios remotamente desde la consola del servidor.

**Ubicaci√≥n:** Clase `Server.java` - M√©todo `kickUser(String username)`

**Implementaci√≥n:**
```java
static void kickUser(String username) {
    ClientHandler target = clients.get(username);
    if (target != null) {
        target.send("[Server]: Has sido eliminado del chat por el administrador.");
        target.forceDisconnect();
        clients.remove(username);
        sendGlobalMessage(null, username + " ha sido eliminado del chat por el administrador.");
        logMessage("Server", "Usuario " + username + " eliminado por el administrador.");
    } else {
        System.out.println("Usuario '" + username + "' no encontrado.");
        logMessage("Server", "Intento de eliminar usuario inexistente: " + username);
    }
}
```

**M√©todo auxiliar en `ClientHandler`:**
```java
void forceDisconnect() {
    try {
        if (socket != null && !socket.isClosed()) {
            socket.close();
        }
    } catch (IOException ignored) {}
}
```

### üìù Uso del Comando `/kick`

**Desde la consola del servidor:**
```
/kick NOMBRE_USUARIO
```

**Ejemplos:**
```
/kick Juan
/kick UsuarioMolesto
/kick Spammer123
```

### üîÑ Proceso de Eliminaci√≥n

**Paso 1:** El administrador escribe el comando en la consola del servidor
```
/kick Juan
```

**Paso 2:** El servidor ejecuta las siguientes acciones:

1. **Busca al usuario** en el mapa de clientes conectados
2. **Notifica al usuario** que ser√° eliminado:
   ```
   [Server]: Has sido eliminado del chat por el administrador.
   ```
3. **Cierra forzosamente** el socket del usuario (`forceDisconnect()`)
4. **Elimina al usuario** del `ConcurrentHashMap` de clientes
5. **Notifica a todos** los usuarios conectados:
   ```
   [Server]: Juan ha sido eliminado del chat por el administrador.
   ```
6. **Registra la acci√≥n** en el log del servidor:
   ```
   2025-10-29 14:30:45 [Server]: Usuario Juan eliminado por el administrador.
   ```

**Paso 3:** El cliente eliminado:
- Recibe la notificaci√≥n
- Su conexi√≥n se cierra autom√°ticamente
- Sale del programa

### üéØ Caracter√≠sticas de Seguridad

‚úÖ **Validaci√≥n de usuarios:** Verifica que el usuario exista antes de intentar eliminarlo

‚úÖ **Notificaci√≥n previa:** El usuario recibe un mensaje antes de ser desconectado

‚úÖ **Transparencia total:** Todos los usuarios son notificados de la acci√≥n administrativa

‚úÖ **Registro completo:** Todas las acciones se registran en el log con timestamp

‚úÖ **Manejo de errores:** Si el usuario no existe, se notifica al administrador sin afectar el sistema

### üìä Mensajes de Ejemplo

**En el servidor:**
```
[NUEVO] Comandos disponibles: 
/kick USUARIO	Eliminar un usuario del chat

2025-10-29 14:30:45 [Server]: Usuario Juan eliminado por el administrador.
```

**En el cliente eliminado (Juan):**
```
[Server]: Has sido eliminado del chat por el administrador.
[Conexi√≥n cerrada]
```

**En todos los dem√°s clientes:**
```
[Server]: Juan ha sido eliminado del chat por el administrador.
```

### üí° Casos de Uso

1. **Moderaci√≥n:** Eliminar usuarios que violan las reglas del chat
2. **Mantenimiento:** Remover conexiones inactivas o problem√°ticas
3. **Seguridad:** Expulsar usuarios sospechosos o maliciosos
4. **Gesti√≥n:** Liberar recursos del servidor eliminando usuarios espec√≠ficos

---

## üõ†Ô∏è Instalaci√≥n y Ejecuci√≥n

### Requisitos Previos
- **Java Development Kit (JDK) 11 o superior**
- **Terminal/CMD** con acceso a comandos Java

### Compilaci√≥n

**1. Compilar el servidor:**
```bash
javac Server.java
```

**2. Compilar el cliente:**
```bash
javac Client.java
```

### Ejecuci√≥n

**1. Iniciar el servidor:**
```bash
java Server
```

**Salida esperada:**
```
Servidor de chat iniciado en puerto 8080
¬°Servidor creado exitosamente!
[NUEVO] Comandos disponibles: 
/kick USUARIO	Eliminar un usuario del chat
```

**2. Conectar clientes:**

**Cliente con conexi√≥n local:**
```bash
java Client
```

**Cliente con nombre predefinido:**
```bash
java Client Maria
```

**Cliente con IP y puerto personalizados:**
```bash
java Client Pedro 192.168.1.100 8080
```

---

## üìö Comandos Disponibles

### Comandos del Cliente

| Comando | Descripci√≥n | Ejemplo |
|---------|-------------|---------|
| `/help` | Muestra lista de comandos | `/help` |
| `/rename NOMBRE` | Cambia tu nombre de usuario | `/rename JuanPerez` |
| `/msg USUARIO MENSAJE` | Env√≠a mensaje privado | `/msg Maria Hola` |
| `/all MENSAJE` | Env√≠a mensaje global | `/all Hola a todos` |
| `MENSAJE` | Env√≠a mensaje global (por defecto) | `Hola` |
| `/quit` | Salir del chat | `/quit` |

### Comandos del Servidor (Administrador)

| Comando | Descripci√≥n | Ejemplo |
|---------|-------------|---------|
| **`/kick USUARIO`** | **Elimina un usuario del chat** | **`/kick Juan`** |
| `MENSAJE` | Env√≠a mensaje global como servidor | `Mantenimiento en 5 min` |

---

## üèóÔ∏è Arquitectura T√©cnica

### Componentes Principales

#### 1. **Servidor (`Server.java`)**
- **Puerto por defecto:** 8080
- **Concurrencia:** `ConcurrentHashMap<String, ClientHandler>` para gesti√≥n thread-safe
- **Hilos:**
  - Hilo principal: Acepta conexiones entrantes
  - Hilo por cliente: Maneja comunicaci√≥n individual (`ClientHandler`)
  - Hilo de consola: Procesa comandos administrativos
- **Logging:** Timestamp autom√°tico en formato `yyyy-MM-dd HH:mm:ss`

#### 2. **Cliente (`Client.java`)**
- **Conexi√≥n:** Socket TCP hacia el servidor
- **Hilos:**
  - Hilo principal: Env√≠o de mensajes al servidor
  - Hilo daemon: Recepci√≥n de mensajes del servidor
- **Manejo de desconexi√≥n:** Cierre limpio de recursos

#### 3. **Manejador de Clientes (`ClientHandler`)**
- **Responsabilidades:**
  - Autenticaci√≥n de usuarios
  - Procesamiento de comandos
  - Env√≠o de mensajes
  - Gesti√≥n de desconexiones

### Flujo de Comunicaci√≥n

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Cliente A  ‚îÇ                  ‚îÇ   Servidor  ‚îÇ                  ‚îÇ  Cliente B  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                                ‚îÇ                                ‚îÇ
       ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ Socket TCP (8080) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                                ‚îÇ
       ‚îÇ                                ‚îÇ                                ‚îÇ
       ‚îÇ<‚îÄ‚îÄ‚îÄ "Ingresa nombre" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                                ‚îÇ
       ‚îÇ                                ‚îÇ                                ‚îÇ
       ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ "Juan" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                                ‚îÇ
       ‚îÇ                                ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ "Juan se uni√≥" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
       ‚îÇ<‚îÄ‚îÄ‚îÄ Confirmaci√≥n ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                                ‚îÇ
       ‚îÇ                                ‚îÇ                                ‚îÇ
       ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ "Hola a todos" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                                ‚îÇ
       ‚îÇ                                ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ "[Juan]: Hola" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
       ‚îÇ                                ‚îÇ                                ‚îÇ
       ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ "/msg Maria Hola" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                                ‚îÇ
       ‚îÇ                                ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ "[Private][Juan]" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
       ‚îÇ                                ‚îÇ                                ‚îÇ
```

### Diagrama de Clases (Simplificado)

```
Server
‚îú‚îÄ‚îÄ ConcurrentMap<String, ClientHandler> clients
‚îú‚îÄ‚îÄ main()
‚îú‚îÄ‚îÄ startConnection()  ‚Üê M√âTODO REQUERIDO (2.5 puntos)
‚îú‚îÄ‚îÄ changeUserName()   ‚Üê M√âTODO REQUERIDO
‚îú‚îÄ‚îÄ sendPrivateMessage() ‚Üê M√âTODO REQUERIDO (send-msg)
‚îú‚îÄ‚îÄ sendGlobalMessage()  ‚Üê M√âTODO REQUERIDO (global-msg)
‚îú‚îÄ‚îÄ kickUser()         ‚Üê FUNCIONALIDAD EXTRA (punto extra)
‚îî‚îÄ‚îÄ ClientHandler
    ‚îú‚îÄ‚îÄ Socket socket
    ‚îú‚îÄ‚îÄ run()
    ‚îú‚îÄ‚îÄ send()
    ‚îî‚îÄ‚îÄ forceDisconnect() ‚Üê NUEVO para /kick

Client
‚îú‚îÄ‚îÄ Socket socket
‚îú‚îÄ‚îÄ startConnection() ‚Üê M√âTODO REQUERIDO (2.5 puntos)
‚îú‚îÄ‚îÄ main()
‚îî‚îÄ‚îÄ closeQuietly()
```

---

## üîí Caracter√≠sticas de Seguridad

‚úÖ **Thread-safe:** Uso de `ConcurrentHashMap` para evitar condiciones de carrera

‚úÖ **Validaci√≥n de nombres:** Nombres √∫nicos y no vac√≠os

‚úÖ **Manejo de excepciones:** Gesti√≥n robusta de `IOException` y `EOFException`

‚úÖ **Cierre de recursos:** Try-with-resources y m√©todos `closeQuietly()`

‚úÖ **Control administrativo:** Comando `/kick` para moderaci√≥n

‚úÖ **Notificaciones transparentes:** Todas las acciones administrativas son visibles

---

## üìä Registro de Mensajes (Logging)

Todos los eventos del servidor se registran con el siguiente formato:

```
yyyy-MM-dd HH:mm:ss [Usuario/Server]: Mensaje
```

**Ejemplos:**
```
2025-10-29 14:25:30 [Server]: Juan se uni√≥ al chat.
2025-10-29 14:26:15 [Juan]: Hola a todos
2025-10-29 14:27:00 [Server]: Juan cambi√≥ su nombre a JuanPerez.
2025-10-29 14:30:45 [Server]: Usuario Juan eliminado por el administrador.
```

---

## üß™ Casos de Prueba

### Prueba 1: Conexi√≥n Exitosa
```bash
# Terminal 1
java Server

# Terminal 2
java Client Juan
```
**Resultado esperado:** Juan conectado y notificaci√≥n global

### Prueba 2: Cambio de Nombre
```bash
/rename JuanPerez
```
**Resultado esperado:** Confirmaci√≥n y notificaci√≥n a todos

### Prueba 3: Mensaje Privado
```bash
/msg Maria Hola, ¬øc√≥mo est√°s?
```
**Resultado esperado:** Solo Maria recibe el mensaje

### Prueba 4: Mensaje Global
```bash
Hola a todos
```
**Resultado esperado:** Todos los usuarios reciben el mensaje

### Prueba 5: Eliminaci√≥n Administrativa
```bash
# En consola del servidor
/kick Juan
```
**Resultado esperado:** 
- Juan desconectado
- Todos notificados
- Log actualizado

---

## üêõ Soluci√≥n de Problemas

### Error: "Connection refused"
**Causa:** Servidor no iniciado o puerto incorrecto  
**Soluci√≥n:** Verificar que el servidor est√© corriendo en el puerto 8080

### Error: "Address already in use"
**Causa:** Puerto 8080 ya est√° en uso  
**Soluci√≥n:** Cerrar la aplicaci√≥n que usa el puerto o cambiar el puerto en el c√≥digo

### Error: Usuario no encontrado al usar `/msg`
**Causa:** Nombre de usuario incorrecto o usuario desconectado  
**Soluci√≥n:** Verificar que el usuario est√© conectado y el nombre sea correcto

### Error: No se puede cambiar nombre con `/rename`
**Causa:** Nombre ya en uso o vac√≠o  
**Soluci√≥n:** Elegir un nombre √∫nico y no vac√≠o

---

## üìà Mejoras Futuras (Opcional)

- üîê Autenticaci√≥n con contrase√±as
- üíæ Persistencia de mensajes en base de datos
- üîî Notificaciones de usuarios en l√≠nea
- üìÅ Transferencia de archivos
- üé® Interfaz gr√°fica (GUI) con JavaFX
- üåê Soporte para m√∫ltiples salas de chat
- üìä Estad√≠sticas de uso y an√°lisis
- üîí Cifrado de mensajes (TLS/SSL)

---

## üë®‚Äçüíª Informaci√≥n del Proyecto
### M√©todos Implementados (Requisitos)

1. ‚úÖ **`start-connection`** - Conexi√≥n IP:Puerto (2.5 puntos)
2. ‚úÖ **`change-userName`** - Cambio de nombre din√°mico
3. ‚úÖ **`send-msg`** - Mensajes privados
4. ‚úÖ **`global-msg`** - Mensajes globales

### Funcionalidad Extra

5. ‚≠ê **`/kick`** - Eliminaci√≥n administrativa de usuarios **(PUNTO EXTRA)**

---

**¬°Disfruta del chat! üí¨**# DiscordLocalServer
